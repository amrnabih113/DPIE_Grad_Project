@model ApplicationUser
@{
    ViewData["Title"] = "Settings - Bookify";
}

<style>
    :root {
        --color-primary: #1e3a5f;
        --color-secondary: #2a5a8f;
        --color-accent: #d4af37;
        --color-gray-50: #f9fafb;
        --color-gray-100: #f3f4f6;
        --color-gray-200: #e5e7eb;
        --color-gray-300: #d1d5db;
        --color-gray-400: #9ca3af;
        --color-gray-500: #6b7280;
        --color-gray-600: #4b5563;
        --color-gray-700: #374151;
        --color-gray-800: #1f2937;
        --color-gray-900: #111827;
        --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
        --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
    }

    .settings-hero {
        background: linear-gradient(135deg, var(--color-primary) 0%, var(--color-secondary) 100%);
        color: white;
        padding: 4rem 0 5rem;
        position: relative;
        overflow: hidden;
    }

    .settings-hero::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1000 100" fill="white" opacity="0.1"><polygon points="1000,100 1000,0 0,100"/></svg>');
        background-size: cover;
        pointer-events: none;
    }

    .settings-hero h1 {
        font-size: 3rem;
        font-weight: 700;
        margin-bottom: 0.5rem;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .settings-hero p {
        font-size: 1.2rem;
        opacity: 0.9;
        margin: 0;
    }

    .settings-main {
        background: var(--color-gray-50);
        padding: 4rem 0;
        margin-top: -2rem;
        position: relative;
        z-index: 1;
        min-height: 80vh;
    }

    .settings-card {
        background: white;
        border-radius: 1.5rem;
        box-shadow: var(--shadow-xl);
        border: none;
        margin-bottom: 2rem;
        transition: all 0.3s ease;
        overflow: hidden;
        position: relative;
    }

    .settings-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: linear-gradient(135deg, var(--color-primary) 0%, var(--color-accent) 100%);
    }

    .settings-card:hover {
        transform: translateY(-3px);
        box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
    }

    .settings-card .card-body {
        padding: 2.5rem;
    }

    .settings-card h3 {
        color: var(--color-primary);
        font-weight: 600;
        margin-bottom: 2rem;
        font-size: 1.5rem;
        display: flex;
        align-items: center;
        gap: 0.75rem;
    }

    .settings-card h3 i {
        width: 2.5rem;
        height: 2.5rem;
        background: linear-gradient(135deg, var(--color-primary) 0%, var(--color-accent) 100%);
        color: white;
        border-radius: 0.75rem;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1rem;
    }

    .form-group {
        margin-bottom: 1.5rem;
    }

    .form-label {
        display: block;
        font-weight: 600;
        margin-bottom: 0.5rem;
        color: var(--color-gray-700);
        font-size: 0.95rem;
    }

    .form-control {
        width: 100%;
        padding: 0.875rem 1rem;
        border: 2px solid var(--color-gray-200);
        border-radius: 0.75rem;
        font-size: 1rem;
        transition: all 0.3s ease;
        background: white;
    }

    .form-control:focus {
        outline: none;
        border-color: var(--color-primary);
        box-shadow: 0 0 0 3px rgba(30, 58, 95, 0.1);
        transform: translateY(-1px);
    }

    .form-control:hover {
        border-color: var(--color-gray-300);
    }

    .form-control:disabled {
        background: var(--color-gray-100);
        color: var(--color-gray-500);
    }

    .form-text {
        color: var(--color-gray-500);
        font-size: 0.875rem;
        margin-top: 0.5rem;
    }

    .btn-primary {
        background: linear-gradient(135deg, var(--color-primary) 0%, var(--color-secondary) 100%);
        border: none;
        color: white;
        font-weight: 600;
        padding: 0.875rem 2rem;
        border-radius: 0.75rem;
        font-size: 1rem;
        transition: all 0.3s ease;
        box-shadow: var(--shadow-md);
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
    }

    .btn-primary:hover {
        background: linear-gradient(135deg, var(--color-secondary) 0%, var(--color-primary) 100%);
        transform: translateY(-2px);
        box-shadow: var(--shadow-lg);
    }

    .preference-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 1.5rem;
        background: var(--color-gray-50);
        border-radius: 1rem;
        margin-bottom: 1rem;
        transition: all 0.3s ease;
        border: 2px solid transparent;
    }

    .preference-item:hover {
        background: white;
        border-color: var(--color-primary);
        box-shadow: var(--shadow-md);
    }

    .preference-content {
        flex: 1;
    }

    .preference-title {
        font-weight: 600;
        color: var(--color-gray-800);
        margin-bottom: 0.5rem;
    }

    .preference-description {
        color: var(--color-gray-600);
        font-size: 0.9rem;
        margin: 0;
    }

    .form-switch .form-check-input {
        width: 3rem;
        height: 1.5rem;
        background-color: var(--color-gray-300);
        border: none;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .form-switch .form-check-input:checked {
        background-color: var(--color-primary);
        border-color: var(--color-primary);
    }

    .form-switch .form-check-input:focus {
        box-shadow: 0 0 0 3px rgba(30, 58, 95, 0.2);
    }

    .alert {
        border: none;
        border-radius: 0.75rem;
        padding: 1rem 1.5rem;
        margin-bottom: 1.5rem;
        font-weight: 500;
        display: flex;
        align-items: center;
        gap: 0.75rem;
    }

    .alert-success {
        background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        color: white;
    }

    .alert-danger {
        background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        color: white;
    }

    .alert .btn-close {
        filter: brightness(0) invert(1);
    }

    .danger-zone {
        background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%);
        border: 2px solid #fca5a5;
        border-radius: 1.5rem;
        padding: 2.5rem;
        margin-top: 3rem;
    }

    .danger-zone h4 {
        color: #dc2626;
        font-weight: 600;
        margin-bottom: 1rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .danger-zone p {
        color: #7f1d1d;
        margin-bottom: 1.5rem;
    }

    .btn-danger {
        background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        border: none;
        color: white;
        font-weight: 600;
        padding: 0.75rem 1.5rem;
        border-radius: 0.75rem;
        transition: all 0.3s ease;
        box-shadow: var(--shadow-md);
    }

    .btn-danger:hover {
        background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
        transform: translateY(-2px);
        box-shadow: var(--shadow-lg);
    }

    .profile-avatar {
        width: 120px;
        height: 120px;
        background: linear-gradient(135deg, var(--color-primary) 0%, var(--color-accent) 100%);
        color: white;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 3rem;
        font-weight: 700;
        margin: 0 auto 2rem;
        box-shadow: var(--shadow-lg);
        position: relative;
    }

    .profile-avatar::after {
        content: '';
        position: absolute;
        bottom: 0;
        right: 0;
        width: 2.5rem;
        height: 2.5rem;
        background: var(--color-accent);
        border: 3px solid white;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
    }


</style>

<div class="settings-hero">
    <div class="container">
        <div class="text-center">
            <div class="profile-avatar">
                @{
                    var userInitials = Model?.FullName?.Split(' ');
                    var initials = userInitials != null && userInitials.Length >= 2 
                        ? userInitials[0].Substring(0, 1).ToUpper() + userInitials[1].Substring(0, 1).ToUpper()
                        : Model?.FullName?.Substring(0, 2).ToUpper() ?? "UN";
                }
                @initials
            </div>
            <h1>Account Settings</h1>
            <p>Manage your profile and preferences to personalize your Bookify experience</p>
        </div>
    </div>
</div>

<div class="settings-main">
    <div class="container" style="max-width: 800px;">

        @if (TempData["Success"] != null)
        {
            <div class="alert alert-success alert-dismissible fade show">
                <i class="fas fa-check-circle"></i>
                @TempData["Success"]
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>
        }

        @if (TempData["Error"] != null)
        {
            <div class="alert alert-danger alert-dismissible fade show">
                <i class="fas fa-exclamation-triangle"></i>
                @TempData["Error"]
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>
        }

        <!-- Profile Information -->
        <div class="settings-card">
            <div class="card-body">
                <h3>
                    <i class="fas fa-user"></i>
                    Profile Information
                </h3>
                <form asp-action="UpdateProfile" method="post">
                    @Html.AntiForgeryToken()
                    
                    <div class="row g-3">
                        <div class="col-12">
                            <div class="form-group">
                                <label class="form-label">Full Name</label>
                                <input type="text" name="fullName" class="form-control" value="@Model.FullName" required placeholder="Enter your full name">
                            </div>
                        </div>
                        
                        <div class="col-12">
                            <div class="form-group">
                                <label class="form-label">Email Address</label>
                                <input type="email" class="form-control" value="@Model.Email" disabled>
                                <div class="form-text">
                                    <i class="fas fa-info-circle me-1"></i>
                                    Email cannot be changed for security reasons
                                </div>
                            </div>
                        </div>
                    </div>

                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i>Save Changes
                    </button>
                </form>
            </div>
        </div>

        <!-- Change Password -->
        <div class="settings-card">
            <div class="card-body">
                <h3>
                    <i class="fas fa-key"></i>
                    Change Password
                </h3>
                <form asp-action="ChangePassword" method="post" id="passwordForm">
                    @Html.AntiForgeryToken()
                    
                    <div class="form-group">
                        <label class="form-label">Current Password</label>
                        <input type="password" name="currentPassword" class="form-control" required placeholder="Enter your current password">
                    </div>

                    <div class="row g-3">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label class="form-label">New Password</label>
                                <input type="password" name="newPassword" class="form-control" required minlength="6" placeholder="Enter new password">
                            </div>
                        </div>
                        
                        <div class="col-md-6">
                            <div class="form-group">
                                <label class="form-label">Confirm New Password</label>
                                <input type="password" name="confirmPassword" class="form-control" required placeholder="Confirm new password">
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-text mb-3">
                        <i class="fas fa-shield-alt me-1"></i>
                        Password must be at least 6 characters long and contain a mix of letters and numbers
                    </div>

                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-key"></i>Update Password
                    </button>
                </form>
            </div>
        </div>

        <!-- Preferences -->
        <div class="settings-card">
            <div class="card-body">
                <h3>
                    <i class="fas fa-sliders-h"></i>
                    Notification Preferences
                </h3>

                <div class="preference-item">
                    <div class="preference-content">
                        <div class="preference-title">Email Notifications</div>
                        <p class="preference-description">Receive booking confirmations, updates, and important account information</p>
                    </div>
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" id="emailNotifications" checked>
                    </div>
                </div>

                <div class="preference-item">
                    <div class="preference-content">
                        <div class="preference-title">Special Offers & Promotions</div>
                        <p class="preference-description">Get notified about exclusive deals, discounts, and special packages</p>
                    </div>
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" id="specialOffers">
                    </div>
                </div>

                <div class="preference-item">
                    <div class="preference-content">
                        <div class="preference-title">Newsletter Subscription</div>
                        <p class="preference-description">Monthly newsletter with travel tips, featured destinations, and company updates</p>
                    </div>
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" id="newsletter" checked>
                    </div>
                </div>

                <div class="preference-item">
                    <div class="preference-content">
                        <div class="preference-title">SMS Notifications</div>
                        <p class="preference-description">Receive booking reminders and urgent updates via text message</p>
                    </div>
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" id="smsNotifications">
                    </div>
                </div>

                <div class="text-center mt-3">
                    <button type="button" class="btn btn-primary" onclick="savePreferences()">
                        <i class="fas fa-save"></i>Save Preferences
                    </button>
                </div>
            </div>
        </div>

        <!-- Danger Zone -->
        <div class="danger-zone">
            <h4>
                <i class="fas fa-exclamation-triangle"></i>
                Danger Zone
            </h4>
            <p>Once you delete your account, there is no going back. Please be certain as this action will permanently remove all your data, bookings, and account information.</p>
            <button type="button" class="btn btn-danger" onclick="confirmAccountDeletion()">
                <i class="fas fa-trash-alt me-2"></i>Delete Account
            </button>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        // Password confirmation validation
        document.getElementById('passwordForm').addEventListener('submit', function(e) {
            const newPassword = document.querySelector('input[name="newPassword"]').value;
            const confirmPassword = document.querySelector('input[name="confirmPassword"]').value;
            
            if (newPassword !== confirmPassword) {
                e.preventDefault();
                
                const alertDiv = document.createElement('div');
                alertDiv.className = 'alert alert-danger alert-dismissible fade show';
                alertDiv.innerHTML = `
                    <i class="fas fa-exclamation-triangle"></i>
                    Passwords do not match. Please try again.
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                `;
                
                this.parentNode.insertBefore(alertDiv, this);
                return false;
            }
        });

        // Save preferences function
        function savePreferences() {
            const preferences = {
                emailNotifications: document.getElementById('emailNotifications').checked,
                specialOffers: document.getElementById('specialOffers').checked,
                newsletter: document.getElementById('newsletter').checked,
                smsNotifications: document.getElementById('smsNotifications').checked
            };

            // In a real application, you would send this to the server
            console.log('Saving preferences:', preferences);

            // Show success message
            const alertDiv = document.createElement('div');
            alertDiv.className = 'alert alert-success alert-dismissible fade show';
            alertDiv.innerHTML = `
                <i class="fas fa-check-circle"></i>
                Preferences saved successfully!
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;

            const container = document.querySelector('.settings-main .container');
            container.insertBefore(alertDiv, container.firstChild);

            // Auto remove after 3 seconds
            setTimeout(() => {
                if (alertDiv.parentNode) {
                    alertDiv.remove();
                }
            }, 3000);
        }

        // Account deletion confirmation
        function confirmAccountDeletion() {
            if (confirm('⚠️ WARNING: This action cannot be undone!\n\nAre you absolutely sure you want to delete your account? This will permanently remove:\n\n• All your booking history\n• Personal information\n• Saved preferences\n• Account access\n\nType "DELETE" in the next prompt to confirm.')) {
                const confirmation = prompt('Please type "DELETE" (in capital letters) to confirm account deletion:');
                if (confirmation === 'DELETE') {
                    alert('Account deletion feature is not implemented in this demo. In a real application, this would permanently delete your account.');
                } else if (confirmation !== null) {
                    alert('Confirmation text did not match. Account deletion cancelled.');
                }
            }
        }

        // Auto-dismiss alerts after 5 seconds
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(() => {
                const alerts = document.querySelectorAll('.alert:not(.manual-dismiss)');
                alerts.forEach(alert => {
                    if (alert.classList.contains('show')) {
                        const closeBtn = alert.querySelector('.btn-close');
                        if (closeBtn) closeBtn.click();
                    }
                });
            }, 5000);

            // Add animation to cards
            const cards = document.querySelectorAll('.settings-card');
            cards.forEach((card, index) => {
                card.style.opacity = '0';

            }
         }
         
</script>
}