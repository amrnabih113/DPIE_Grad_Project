@model Bookify.Data.Models.Booking
@{
    ViewData["Title"] = "Booking Details";
    
    var statusClass = Model.PaymentStatus?.ToLower() switch
    {
        "confirmed" => "status-confirmed",
        "pending" => "status-pending",
        "cancelled" => "status-cancelled",
        "completed" => "status-completed",
        _ => "status-pending"
    };

    var nights = (Model.CheckOut - Model.CheckIn).Days;
}

<style>
    .details-container {
        display: grid;
        grid-template-columns: 1fr 400px;
        gap: var(--spacing-2xl);
        margin-top: var(--spacing-xl);
    }

    @@media (max-width: 1024px) {
        .details-container {
            grid-template-columns: 1fr;
        }
    }

    .details-card {
        background: white;
        border-radius: var(--radius-lg);
        box-shadow: var(--shadow-md);
        overflow: hidden;
    }

    .details-header {
        background: linear-gradient(135deg, var(--color-primary), var(--color-primary-light));
        color: white;
        padding: var(--spacing-xl);
    }

    .details-content {
        padding: var(--spacing-xl);
    }

    .detail-row {
        display: flex;
        justify-content: space-between;
        padding: var(--spacing-md) 0;
        border-bottom: 1px solid var(--color-gray-200);
    }

    .detail-row:last-child {
        border-bottom: none;
    }

    .detail-label {
        color: var(--color-gray-600);
    }

    .detail-value {
        font-weight: var(--font-weight-semibold);
    }

    .status-badge {
        display: inline-block;
        padding: 4px 12px;
        border-radius: 20px;
        font-size: var(--font-size-sm);
        font-weight: var(--font-weight-semibold);
    }

    .status-confirmed {
        background: #DEF7EC;
        color: #03543F;
    }

    .status-pending {
        background: #FEF3C7;
        color: #92400E;
    }

    .status-cancelled {
        background: #FEE2E2;
        color: #991B1B;
    }

    .status-completed {
        background: #E0E7FF;
        color: #3730A3;
    }

    .room-image {
        width: 100%;
        height: 250px;
        object-fit: cover;
    }

    .price-summary {
        background: var(--color-gray-50);
        padding: var(--spacing-lg);
        border-radius: var(--radius-md);
        margin-top: var(--spacing-lg);
    }

    .price-row {
        display: flex;
        justify-content: space-between;
        padding: var(--spacing-sm) 0;
    }

    .price-total {
        display: flex;
        justify-content: space-between;
        padding-top: var(--spacing-md);
        margin-top: var(--spacing-md);
        border-top: 2px solid var(--color-primary);
        font-size: var(--font-size-xl);
        font-weight: var(--font-weight-bold);
        color: var(--color-primary);
    }

    .action-buttons {
        display: flex;
        gap: var(--spacing-md);
        margin-top: var(--spacing-xl);
    }
</style>

<main class="py-8">
    <div class="container">
        <div style="margin-bottom: var(--spacing-lg);">
            <a asp-action="Index" class="btn btn-outline">
                <i class="fas fa-arrow-left"></i> Back to My Bookings
            </a>
        </div>

        @if (TempData["SuccessMessage"] != null)
        {
            <div class="alert alert-success mb-4" style="background: #DEF7EC; color: #03543F; padding: var(--spacing-lg); border-radius: var(--radius-md); display: flex; align-items: center; gap: var(--spacing-md);">
                <i class="fas fa-check-circle" style="font-size: 1.5rem;"></i>
                <span>@TempData["SuccessMessage"]</span>
            </div>
        }

        <div class="details-container">
            <!-- Main Details -->
            <div>
                <div class="details-card">
                    <div class="details-header">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <h2 style="margin-bottom: var(--spacing-xs);">Booking #@Model.Id</h2>
                                <p style="opacity: 0.9;">Booked on @Model.CreatedAt.ToString("MMMM dd, yyyy")</p>
                            </div>
                            <span class="status-badge @statusClass">@(Model.PaymentStatus ?? "Pending")</span>
                        </div>
                    </div>

                    <div class="details-content">
                        <h3 class="text-primary mb-4">Stay Details</h3>

                        <div class="detail-row">
                            <span class="detail-label"><i class="fas fa-calendar-check"></i> Check-in</span>
                            <span class="detail-value">@Model.CheckIn.ToString("dddd, MMMM dd, yyyy")</span>
                        </div>

                        <div class="detail-row">
                            <span class="detail-label"><i class="fas fa-calendar-times"></i> Check-out</span>
                            <span class="detail-value">@Model.CheckOut.ToString("dddd, MMMM dd, yyyy")</span>
                        </div>

                        <div class="detail-row">
                            <span class="detail-label"><i class="fas fa-moon"></i> Duration</span>
                            <span class="detail-value">@nights Night@(nights > 1 ? "s" : "")</span>
                        </div>

                        <div class="detail-row">
                            <span class="detail-label"><i class="fas fa-users"></i> Guests</span>
                            <span class="detail-value">@Model.NumberOfGuests Guest@(Model.NumberOfGuests > 1 ? "s" : "")</span>
                        </div>

                        <h3 class="text-primary mb-4 mt-6">Payment Information</h3>

                        <div class="detail-row">
                            <span class="detail-label"><i class="fas fa-credit-card"></i> Payment Status</span>
                            <span class="status-badge @statusClass">@(Model.PaymentStatus ?? "Pending")</span>
                        </div>

                        @if (!string.IsNullOrEmpty(Model.PaymentMethod))
                        {
                            <div class="detail-row">
                                <span class="detail-label"><i class="fas fa-wallet"></i> Payment Method</span>
                                <span class="detail-value">@Model.PaymentMethod</span>
                            </div>
                        }

                        @if (Model.PaymentDate.HasValue)
                        {
                            <div class="detail-row">
                                <span class="detail-label"><i class="fas fa-clock"></i> Payment Date</span>
                                <span class="detail-value">@Model.PaymentDate.Value.ToString("MMMM dd, yyyy")</span>
                            </div>
                        }

                        <div class="action-buttons">
                            @if (Model.PaymentStatus?.ToLower() != "cancelled" && Model.CheckIn > DateTime.Now)
                            {
                                <a asp-action="Edit" asp-route-id="@Model.Id" class="btn btn-outline">
                                    <i class="fas fa-edit"></i> Modify Booking
                                </a>
                                <a asp-action="Cancel" asp-route-id="@Model.Id" class="btn btn-danger"
                                   onclick="return confirm('Are you sure you want to cancel this booking?');">
                                    <i class="fas fa-times"></i> Cancel Booking
                                </a>
                            }
                            <button onclick="window.print();" class="btn btn-outline">
                                <i class="fas fa-print"></i> Print
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Room Summary -->
            <div>
                <div class="details-card">
                    @if (Model.Room?.RoomImages?.Any() == true)
                    {
                        <img src="@Model.Room.RoomImages.First().ImageUrl" alt="@Model.Room.Name" class="room-image"
                             onerror="this.src='/images/placeholder-room.jpg'">
                    }
                    else
                    {
                        <img src="/images/placeholder-room.jpg" alt="Room" class="room-image">
                    }

                    <div class="details-content">
                        <h3 class="text-primary mb-2">@(Model.Room?.Name ?? "Room")</h3>
                        <p class="text-gray mb-4">@(Model.Room?.RoomType?.Name ?? "Standard Room")</p>

                        @if (Model.Room != null)
                        {
                            <div class="detail-row">
                                <span class="detail-label">Max Guests</span>
                                <span class="detail-value">@Model.Room.MaxGuests</span>
                            </div>

                            <div class="detail-row">
                                <span class="detail-label">Price per Night</span>
                                <span class="detail-value">$@Model.Room.PriceForNight.ToString("N2")</span>
                            </div>
                        }

                        <div class="price-summary">
                            <h4 class="mb-3">Price Breakdown</h4>
                            
                            @if (Model.Room != null)
                            {
                                var subtotal = Model.Room.PriceForNight * nights;
                                var tax = Model.TotalPrice - subtotal;

                                <div class="price-row">
                                    <span>$@Model.Room.PriceForNight.ToString("N2") Ã— @nights nights</span>
                                    <span>$@subtotal.ToString("N2")</span>
                                </div>

                                <div class="price-row">
                                    <span>Taxes & Fees</span>
                                    <span>$@tax.ToString("N2")</span>
                                </div>
                            }

                            <div class="price-total">
                                <span>Total</span>
                                <span>$@Model.TotalPrice.ToString("N2")</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</main>
