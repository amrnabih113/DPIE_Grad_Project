@model Bookify.Data.Models.Booking
@{
    ViewData["Title"] = "Booking Details";
    
    var statusClass = Model.PaymentStatus?.ToLower() switch
    {
        "confirmed" => "status-confirmed",
        "pending" => "status-pending",
        "cancelled" => "status-cancelled",
        "completed" => "status-completed",
        _ => "status-pending"
    };

    var nights = (Model.CheckOut - Model.CheckIn).Days;
}

<style>
    .alert {
        padding: var(--spacing-md) var(--spacing-lg);
        border-radius: var(--radius-md);
        margin-bottom: var(--spacing-lg);
        display: flex;
        align-items: center;
        gap: var(--spacing-sm);
    }

    .alert-success {
        background: #DEF7EC;
        color: #03543F;
        border: 1px solid #84E1BC;
    }

    .alert-error {
        background: #FDE8E8;
        color: #9B1C1C;
        border: 1px solid #F98080;
    }

    .details-container {
        display: grid;
        grid-template-columns: 1fr 400px;
        gap: var(--spacing-2xl);
        margin-top: var(--spacing-xl);
    }

    @@media (max-width: 1024px) {
        .details-container {
            grid-template-columns: 1fr;
        }
    }

    .details-card {
        background: white;
        border-radius: var(--radius-lg);
        box-shadow: var(--shadow-md);
        overflow: hidden;
    }

    .details-header {
        background: linear-gradient(135deg, var(--color-primary), var(--color-primary-light));
        color: white;
        padding: var(--spacing-xl);
    }

    .details-content {
        padding: var(--spacing-xl);
    }

    .detail-row {
        display: flex;
        justify-content: space-between;
        padding: var(--spacing-md) 0;
        border-bottom: 1px solid var(--color-gray-200);
    }

    .detail-row:last-child {
        border-bottom: none;
    }

    .detail-label {
        color: var(--color-gray-600);
    }

    .detail-value {
        font-weight: var(--font-weight-semibold);
    }

    .status-badge {
        display: inline-block;
        padding: 4px 12px;
        border-radius: 20px;
        font-size: var(--font-size-sm);
        font-weight: var(--font-weight-semibold);
    }

    .status-confirmed {
        background: #DEF7EC;
        color: #03543F;
    }

    .status-pending {
        background: #FEF3C7;
        color: #92400E;
    }

    .status-cancelled {
        background: #FEE2E2;
        color: #991B1B;
    }

    .status-completed {
        background: #E0E7FF;
        color: #3730A3;
    }

    .room-image {
        width: 100%;
        height: 250px;
        object-fit: cover;
    }

    .price-summary {
        background: var(--color-gray-50);
        padding: var(--spacing-lg);
        border-radius: var(--radius-md);
        margin-top: var(--spacing-lg);
    }

    .price-row {
        display: flex;
        justify-content: space-between;
        padding: var(--spacing-sm) 0;
    }

    .price-total {
        display: flex;
        justify-content: space-between;
        padding-top: var(--spacing-md);
        margin-top: var(--spacing-md);
        border-top: 2px solid var(--color-primary);
        font-size: var(--font-size-xl);
        font-weight: var(--font-weight-bold);
        color: var(--color-primary);
    }

    .action-buttons {
        display: flex;
        gap: var(--spacing-md);
        margin-top: var(--spacing-xl);
    }
</style>

<main class="py-8">
    <div class="container">
        <div style="margin-bottom: var(--spacing-lg);">
            <a asp-action="Index" class="btn btn-outline">
                <i class="fas fa-arrow-left"></i> Back to My Bookings
            </a>
        </div>

        @if (TempData["SuccessMessage"] != null)
        {
            <div class="alert alert-success">
                <i class="fas fa-check-circle" style="font-size: 1.5rem;"></i>
                <span>@TempData["SuccessMessage"]</span>
            </div>
        }

        @if (TempData["ErrorMessage"] != null)
        {
            <div class="alert alert-error">
                <i class="fas fa-exclamation-circle" style="font-size: 1.5rem;"></i>
                <span>@TempData["ErrorMessage"]</span>
            </div>
        }

        <div class="details-container">
            <!-- Main Details -->
            <div>
                <div class="details-card">
                    <div class="details-header">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <h2 style="margin-bottom: var(--spacing-xs);">Booking #@Model.Id</h2>
                                <p style="opacity: 0.9;">@(Model.PaymentStatus?.ToLower() == "pending" ? "Submitted on" : "Booked on") @Model.CreatedAt.ToString("MMMM dd, yyyy")</p>
                            </div>
                            <span class="status-badge @statusClass">@(Model.PaymentStatus ?? "Pending")</span>
                        </div>
                    </div>

                    <div class="details-content">
                        @if (Model.PaymentStatus?.ToLower() == "pending")
                        {
                            <div style="background: linear-gradient(135deg, #FEF3C7 0%, #FDE68A 100%); padding: var(--spacing-lg); border-radius: var(--radius-lg); margin-bottom: var(--spacing-xl); border: 2px solid #FBBF24;">
                                <div style="display: flex; align-items: center; gap: var(--spacing-sm); margin-bottom: var(--spacing-sm);">
                                    <svg width="24" height="24" viewBox="0 0 20 20" fill="#D97706">
                                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd" />
                                    </svg>
                                    <h4 style="margin: 0; color: #92400E; font-weight: 600;">Booking Request Pending Approval</h4>
                                </div>
                                <p style="color: #78350F; margin: 0; font-size: var(--font-size-sm); line-height: 1.5;">
                                    Your booking request has been submitted successfully and is currently awaiting admin approval. 
                                    You will receive a notification once the admin reviews your request. The reservation dates you selected will be held until the admin makes a decision.
                                </p>
                            </div>
                        }

                        <h3 class="text-primary mb-4">@(Model.PaymentStatus?.ToLower() == "pending" ? "Requested" : "Stay") Details</h3>

                        <div class="detail-row">
                            <span class="detail-label"><i class="fas fa-calendar-check"></i> @(Model.PaymentStatus?.ToLower() == "pending" ? "Requested Check-in" : "Check-in")</span>
                            <span class="detail-value">@Model.CheckIn.ToString("dddd, MMMM dd, yyyy")</span>
                        </div>

                        <div class="detail-row">
                            <span class="detail-label"><i class="fas fa-calendar-times"></i> @(Model.PaymentStatus?.ToLower() == "pending" ? "Requested Check-out" : "Check-out")</span>
                            <span class="detail-value">@Model.CheckOut.ToString("dddd, MMMM dd, yyyy")</span>
                        </div>

                        <div class="detail-row">
                            <span class="detail-label"><i class="fas fa-moon"></i> Duration</span>
                            <span class="detail-value">@nights Night@(nights > 1 ? "s" : "")</span>
                        </div>

                        <div class="detail-row">
                            <span class="detail-label"><i class="fas fa-users"></i> Guests</span>
                            <span class="detail-value">@Model.NumberOfGuests Guest@(Model.NumberOfGuests > 1 ? "s" : "")</span>
                        </div>

                        <h3 class="text-primary mb-4 mt-6">Payment Information</h3>

                        <div class="detail-row">
                            <span class="detail-label"><i class="fas fa-credit-card"></i> Payment Status</span>
                            <span class="status-badge @statusClass">@(Model.PaymentStatus ?? "Pending")</span>
                        </div>

                        @if (!string.IsNullOrEmpty(Model.PaymentMethod))
                        {
                            <div class="detail-row">
                                <span class="detail-label"><i class="fas fa-wallet"></i> Payment Method</span>
                                <span class="detail-value">@Model.PaymentMethod</span>
                            </div>
                        }

                        @if (Model.PaymentDate.HasValue)
                        {
                            <div class="detail-row">
                                <span class="detail-label"><i class="fas fa-clock"></i> Payment Date</span>
                                <span class="detail-value">@Model.PaymentDate.Value.ToString("MMMM dd, yyyy")</span>
                            </div>
                        }

                        <div class="action-buttons">
                            @if (Model.PaymentStatus?.ToLower() == "pending" && Model.CheckIn.Date >= DateTime.Today)
                            {
                                <a asp-action="Edit" asp-route-id="@Model.Id" class="btn btn-outline">
                                    <i class="fas fa-edit"></i> Modify Request
                                </a>
                                <form asp-action="Cancel" asp-route-id="@Model.Id" method="post" style="display: inline;"
                                   onsubmit="return confirm('Are you sure you want to cancel this booking request?');">
                                    @Html.AntiForgeryToken()
                                    <button type="submit" class="btn btn-danger">
                                        <i class="fas fa-times"></i> Cancel Request
                                    </button>
                                </form>
                            }
                            <button onclick="window.print();" class="btn btn-outline">
                                <i class="fas fa-print"></i> Print
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Room Summary -->
            <div>
                <div class="details-card">
                    @if (Model.Room?.RoomImages?.Any() == true)
                    {
                        <img src="@Model.Room.RoomImages.First().ImageUrl" alt="@Model.Room.Name" class="room-image"
                             onerror="this.src='/images/placeholder-room.jpg'">
                    }
                    else
                    {
                        <img src="/images/placeholder-room.jpg" alt="Room" class="room-image">
                    }

                    <div class="details-content">
                        <h3 class="text-primary mb-2">@(Model.Room?.Name ?? "Room")</h3>
                        <p class="text-gray mb-4">@(Model.Room?.RoomType?.Name ?? "Standard Room")</p>

                        @if (Model.Room != null)
                        {
                            <div class="detail-row">
                                <span class="detail-label">Max Guests</span>
                                <span class="detail-value">@Model.Room.MaxGuests</span>
                            </div>

                            <div class="detail-row">
                                <span class="detail-label">Price per Night</span>
                                <span class="detail-value">$@Model.Room.PriceForNight.ToString("N2")</span>
                            </div>
                        }

                        <div class="price-summary">
                            <h4 class="mb-3">Price Breakdown</h4>
                            
                            @if (Model.Room != null)
                            {
                                var subtotal = Model.Room.PriceForNight * nights;
                                var tax = Model.TotalPrice - subtotal;

                                <div class="price-row">
                                    <span>$@Model.Room.PriceForNight.ToString("N2") Ã— @nights nights</span>
                                    <span>$@subtotal.ToString("N2")</span>
                                </div>

                                <div class="price-row">
                                    <span>Taxes & Fees</span>
                                    <span>$@tax.ToString("N2")</span>
                                </div>
                            }

                            <div class="price-total">
                                <span>Total</span>
                                <span>$@Model.TotalPrice.ToString("N2")</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</main>
