@model Bookify.Models.ViewModels.RoomIndexViewModel

<div class="d-flex justify-content-between align-items-center mb-4">
    <p class="text-gray mb-0" id="resultsCount">@Model.Rooms.Count() room(s) found</p>
    <select id="sortBy" name="order" class="form-select" style="width: auto; max-width: 200px;" onchange="applyFilters(1)">
        <option value="popular">Most Popular</option>
        <option value="price_asc">Price: Low to High</option>
        <option value="price_desc">Price: High to Low</option>
        <option value="rating_desc">Highest Rated</option>
    </select>
</div>

<div id="roomsList" style="display: flex; flex-direction: column; gap: var(--spacing-xl);">
    @if (!Model.Rooms.Any())
    {
        <div class="empty-state">
            <svg width="64" height="64" viewBox="0 0 20 20" fill="currentColor" style="margin: 0 auto var(--spacing-md);">
                <path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd" />
            </svg>
            <h3>No rooms found</h3>
            <p>Try adjusting your filters to see more results</p>
            <button class="btn btn-primary mt-3" onclick="clearFilters()">Clear All Filters</button>
        </div>
    }
    else
    {
        @foreach (var room in Model.Rooms)
        {
            <div class="room-card fade-in position-relative">
                <div class="room-image-wrapper position-relative" style="position:relative;">
                    @if (!string.IsNullOrEmpty(room.BookingStatus))
                    {
                        <div style="position: absolute; top: 1rem; left: 1rem; z-index: 10; background: @(room.BookingStatus == "Pending" ? "rgba(251, 191, 36, 0.95)" : "rgba(239, 68, 68, 0.95)"); color: white; padding: 0.5rem 1rem; border-radius: 20px; font-size: 0.75rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; box-shadow: 0 2px 8px rgba(0,0,0,0.2);">
                            @(room.BookingStatus == "Pending" ? "⏳ Pending" : "🔒 Booked")
                        </div>
                    }
                    <img src="@room.ImageUrl" alt="@(room.Name ?? "Room")" class="room-card-image w-100" 
                         onerror="this.src='https://images.unsplash.com/photo-1611892440504-42a792e24d32?w=800&q=80'"
                         loading="lazy" style="width: 100%; height: 250px; object-fit: cover; display: block;">

                    <button class="btn btn-light rounded-circle favorite-btn shadow-sm position-absolute top-0 end-0 m-3"
                        data-room-id="@room.Id"
                        style="background-color: #ffffffbd; border-radius: 50%; position:absolute;top:5px;right:5px; width: 45px; height: 45px; padding: 0; display: flex; align-items: center; justify-content: center; z-index: 10;">
                        <i class="@(room.IsFavorite ? "fa-solid fa-heart" : "fa-regular fa-heart")"
                           style="font-size: 1.5rem; @(room.IsFavorite ? "color: #ff0000;" : "")">
                        </i>
                    </button>
                </div>

                <div class="room-card-content">
                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: var(--spacing-sm);">
                        <div>
                            <h3 class="text-primary">@(room.Name ?? "Room " + room.Id)</h3>
                        </div>
                        @if (room.DiscountPercentage.HasValue && room.DiscountPercentage > 0)
                        {
                            <div class="badge badge-danger">@room.DiscountPercentage% OFF</div>
                        }
                    </div>

                    <div class="rating">
                        @for (int i = 1; i <= 5; i++)
                        {
                            <span style="color: @(i <= room.Rating ? "#fbbf24" : "#d1d5db");">★</span>
                        }
                    </div>

                    <p style="color: var(--color-gray-500); font-size: var(--font-size-sm); margin-top: var(--spacing-xs);">
                        @room.NumberOfReviews reviews
                    </p>

                    @if (!string.IsNullOrEmpty(room.Description))
                    {
                        <p class="text-gray mt-3">
                            @(room.Description.Length > 70 ? room.Description.Substring(0, 70) + "..." : room.Description)
                        </p>
                    }

                    <div class="amenities-list">
                        @if (room.Amenities != null && room.Amenities.Any())
                        {
                            @foreach (var amenity in room.Amenities.Take(5))
                            {
                                <span class="amenity-tag">@amenity.Name</span>
                            }
                            @if (room.Amenities.Count() > 5)
                            {
                                <span class="amenity-tag">+@(room.Amenities.Count() - 5) more</span>
                            }
                        }
                    </div>

                    <div style="display: flex; justify-content: space-between; align-items: center; margin-top: auto; padding-top: var(--spacing-lg);">
                        <div>
                            <div style="display: flex; align-items: baseline; gap: var(--spacing-xs);">
                                <span style="font-size: var(--font-size-3xl); font-weight: var(--font-weight-bold); color: var(--color-primary);">$@room.FinalPrice</span>
                                @if (room.DiscountPercentage.HasValue && room.DiscountPercentage > 0)
                                {
                                    <span class="text-gray" style="text-decoration: line-through; font-size: var(--font-size-sm);">$@room.PricePerNight</span>
                                }
                                <span class="text-gray" style="font-size: var(--font-size-sm);">/ night</span>
                            </div>
                            <p class="text-gray" style="font-size: var(--font-size-sm);">
                                @room.NumberOfGusts guests · @room.Area sq ft
                            </p>
                        </div>
                        <a asp-controller="Room" asp-action="Details" asp-route-id="@room.Id" class="btn btn-primary">View Details</a>
                    </div>
                </div>
            </div>
        }
        @if (Model.TotalPages > 1)
        {
            <div class="d-flex justify-content-center mt-4 gap-2">
                @if (Model.CurrentPage > 1)
                {
                    <button class="btn btn-outline-secondary" onclick="applyFilters(@(Model.CurrentPage - 1))">Previous</button>
                }

                @for (int i = 1; i <= Model.TotalPages; i++)
                {
                    <button class="btn @(i == Model.CurrentPage ? "btn-primary" : "btn-outline-secondary")" onclick="applyFilters(@i)">@i</button>
                }

                @if (Model.CurrentPage < Model.TotalPages)
                {
                    <button class="btn btn-outline-secondary" onclick="applyFilters(@(Model.CurrentPage + 1))">Next</button>
                }
            </div>
        }
    }
</div>

<script>
    // Set selected option based on Model.SelectedOrder
    document.addEventListener('DOMContentLoaded', function() {
        var sortSelect = document.getElementById('sortBy');
        if (sortSelect && '@Model.SelectedOrder') {
            sortSelect.value = '@Model.SelectedOrder';
        }
    });
</script>

